<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap> 
	<!-- 最后更新时间-->
	<select id="c_campus.lasttime.max" resultClass="mapBean" parameterClass="map" >
		select max(lasttime) as "lasttime" from c_campus
	</select> 
	
	<insert id="c_campus.insert" parameterClass="map" >
         insert into C_CAMPUS 
         (ID, C_NAME, CAN_GET_CARD, PID, LASTTIME) 
         values (#id#, #c_name#, #can_get_card#, #pid#, #lasttime#)		


	</insert> 
	<!-- 校区增量比对-->
	<select id="find.c_campus.new" resultClass="mapBean" parameterClass="map" >
		select c_campus.* from c_campus left outer join
 		T_PARKING_LOT on  c_campus.ID=T_PARKING_LOT.campus_id
		where c_campus.PID=0 and T_PARKING_LOT.ID is null
	</select> 
	<!-- 校区变更比对-->
	<select id="find.c_campus.update" resultClass="mapBean" parameterClass="map" >
		select c_campus.*,T_PARKING_LOT.ID as "PARKING_LOT_ID" from c_campus ,
 		T_PARKING_LOT where  c_campus.ID=T_PARKING_LOT.campus_id
 		and c_campus.PID=0 and (c_campus.C_NAME!=T_PARKING_LOT.NAME 
		or c_campus.CAN_GET_CARD!=T_PARKING_LOT.can_get_card)
	</select> 
	
	<!-- 校门增量比对-->
	<select id="find.c_campus.door.new" resultClass="mapBean" parameterClass="map" >
		select c_campus.*,T_PARKING_LOT.ID as "PARKING_LOT_ID" from c_campus left outer join
 		t_campus on  c_campus.ID=t_campus.campus_id
, T_PARKING_LOT 
		where c_campus.PID>0 and t_campus.ID is null
and c_campus.pid=T_PARKING_LOT.campus_id
	</select> 
	
	<!-- 校区变更比对-->
	<select id="find.c_campus.door.update" resultClass="mapBean" parameterClass="map" >
		select c_campus.*,T_PARKING_LOT.ID as "PARKING_LOT_ID",t_campus.ID as "DOOR_ID" from c_campus left outer join
 		t_campus on  c_campus.ID=t_campus.campus_id
, T_PARKING_LOT 
		where c_campus.PID>0  
and c_campus.pid=T_PARKING_LOT.campus_id and 
(c_campus.C_NAME!=t_campus.NAME or T_PARKING_LOT.ID!=t_campus.PARKING_LOT_ID)
	</select> 
	
	<!-- 删除所有进校证类型中间表c_card_type-->
	<delete id="c_card_type.all.delete"  parameterClass="map" >
		delete from c_card_type
	</delete> 
	
	<!-- 进校证类型增量对比-->
	<select id="find.t_card_type.new" resultClass="cardType" parameterClass="map" >
		select
			c.ctype as "cardtype",c.cname as "name",c.cnumber as "cardnumber",c.cmod,
			c.need_rel as "needrel",c.d_car as "dcar",c.can_search as "cansearch",
			c.day_stop_mf as "daystopmf",c.night_stop_mf as "nightstopmf",
			c.cyear as "year",c.fee,c.xm_ids as "xmids",c.buban,c.biangeng,c.lasttime,
			c.status,c.id as "oldcardtypeid"
		from
			c_card_type c
		left outer join t_card_type t on c. id = t.old_card_type_id
		where
			t. id is null
	</select> 
	
	<!-- 进校证类型变更对比-->
	<select id="find.t_card_type.update" resultClass="cardType" parameterClass="map" >
		SELECT
			c.CTYPE as "cardtype",c.cname as "name",c.cnumber as "cardnumber",c.cmod,
			c.need_rel as "needrel",c.d_car as "dcar",c.can_search as "cansearch",
			c.day_stop_mf as "daystopmf",c.night_stop_mf as "nightstopmf",
			c.CYEAR as "year",c.FEE,c.xm_ids as "xmids",c.BUBAN,c.BIANGENG,c.LASTTIME,
			c.status,c.id as "oldcardtypeid",t.id
		from
			c_card_type c,
			t_card_type t
		where
			c. id = t.old_card_type_id
		and nvl (c.lasttime, 0) > nvl (t.lasttime, 0)
	</select>  
	<insert id="c_card_type.insert" parameterClass="map" >
	insert into C_CARD_TYPE (ID, CTYPE, CNAME, CNUMBER, CMOD, NEED_REL, D_CAR, CAN_SEARCH, DAY_STOP_MF, NIGHT_STOP_MF, CYEAR, FEE, XM_IDS, BUBAN, BIANGENG, LASTTIME, STATUS) values 
	(#id#, #type#, #name#, #number#, #mod#, #need_rel#, #d_car#, #can_search#, #day_stop_mf#, #night_stop_mf#, #year#, #fee#, #xm_ids#, #buban#, #biangeng#, #lasttime#, #status#)
	</insert>
	
	<!-- 收费规则 start-->
	<delete id="c_shoufei.all.delete" parameterClass="map" >
		delete from c_shoufei
	</delete>
	<insert id="c_shoufei.insert" parameterClass="map" >
		 insert into c_shoufei 
		 (id,type_id,cid,day_time,night_time,day_hour_money,
		 night_hour_money,day_max_money,night_max_money,
		 everyday_mianfei_time,lasttime)
		 values  (#id#,#type_id#,#cid#,#day_time#,#night_time#,#day_hour_money#,
		 #night_hour_money#,#day_max_money#,#night_max_money#,
		 #everyday_mianfei_time#,#lasttime#)
	</insert> 
	<select id="find.t_shoufei.new" resultClass="mapBean" parameterClass="map" >
		select c_shoufei.* from c_shoufei 
			left outer join t_shoufei on t_shoufei.OLD_SHOUFEI_ID = c_shoufei.id 
		where t_shoufei.id is null
	</select> 
	<!-- 收费规则对比-->
	<select id="find.t_shoufei.update" resultClass="mapBean" parameterClass="map" >
		select c_shoufei.*,t_shoufei.id as "NEWID" from c_shoufei,t_shoufei
				where c_shoufei.id = t_shoufei.OLD_SHOUFEI_ID 
					and nvl(c_shoufei.lasttime*1000,0)!=nvl(t_shoufei.lasttime,0)
	</select>
	<!-- 收费规则 end -->
	
	<!-- 进校证数据 start -->
	<delete id="c_card_info.all.delete" parameterClass="map" >
		delete from c_card_info
	</delete>
	<insert id="c_card_info.insert" parameterClass="map" >
		 insert into c_card_info 
		 (id,card_no,card_type_id,status,owner,car_no,expire_date,
		 y_name,xm_ids,lasttime,type_name,type_id,user_no,user_name,
		 front_prints,bg_prints,user_type_id,is_pay,car_type,
		 day_stop_mf,night_stop_mf,use_status)
		 values  (#id#,#card_no#,#card_type_id#,#status#,#owner#,#car_no#,#expire_date#,
		 #y_name#,#xm_ids#,#lasttime#,#type_name#,#type_id#,#user_no#,#user_name#,
		 #front_prints#,#bg_prints#,#user_type_id#,#is_pay#,#car_type#,
		 #day_stop_mf#,#night_stop_mf#,#use_status#)
	</insert> 
	<!-- 增量对比-->
	<select id="find.t_card_infoByOldInfo.new" resultClass="cardInfo" parameterClass="map" >
		select
			c.card_no as "cardno",c.card_type_id as "cardtype",c.status,c.owner,c.card_no as "carno",
			c.expire_date as "expiredate",c.y_name as "yname",c.xm_ids as "xmids",c.lasttime,
			c.type_name as "typename",c.type_id as "typeid",c.user_no as "userno",c.user_name as "username",
			c.front_prints as "frontprints",c.bg_prints as "bgprints",c.user_type_id as "usertypeid",
			c.is_pay as "ispay",c.car_type as "cartype",c.day_stop_mf as "daystopmf",c.night_stop_mf as "nightstopmf",
			c.use_status as "usestatus",c.id as "oldCardInfoId"
		from
			c_card_info c
				left outer join t_card_info t on c. id = t.old_card_info_id
		where
			t.id is null
	</select> 
	<!-- 变更对比-->
	<select id="find.t_card_infoByOldInfo.update" resultClass="cardInfo" parameterClass="map" >
		select
			c.card_no as "cardno",c.card_type_id as "cardtype",c.status,c.owner,c.card_no as "carno",
			c.expire_date as "expiredate",c.y_name as "yname",c.xm_ids as "xmids",c.lasttime,
			c.type_name as "typename",c.type_id as "typeid",c.user_no as "userno",c.user_name as "username",
			c.front_prints as "frontprints",c.bg_prints as "bgprints",c.user_type_id as "usertypeid",
			c.is_pay as "ispay",c.car_type as "cartype",c.day_stop_mf as "daystopmf",c.night_stop_mf as "nightstopmf",
			c.use_status as "usestatus",c.id as "oldCardInfoId",t.id
		from
			c_card_info c,
			t_card_info t
		where
			c. id = t.old_card_info_id
		and nvl (c.lasttime, 0) > nvl (t.lasttime, 0)
	</select>
	
	
	<delete id="c_card_temp.all.delete" parameterClass="map" >
		delete from c_card_temp
	</delete>
	<insert id="c_card_temp.insert" parameterClass="map" >
		 insert into c_card_temp 
		 (id,year,month,dept_no,dept_name,owner,mobile,car_no,use_date,
		 note,user_id,status,car_type,temp_id,xm_ids)
		 values  (#id#,#year#,#month#,#dept_no#,#dept_name#,#owner#,#mobile#,#car_no#,#use_date#,
		 #note#,#user_id#,#status#,#car_type#,#temp_id#,#xm_ids#)
	</insert> 
	<!-- 增量对比-->
	<select id="find.t_card_infoByOldTemp.new" resultClass="cardInfo" parameterClass="map" >
		select
			2 as "cardType",c.year,c.month,c.dept_no as "deptno",c.dept_name as "deptname",c.owner,
			c.mobile,c.car_no as "carno", c.use_date as "expiredate",c.note,c.user_id as "userid",
			c.status,c.car_type as "cartype",c.temp_id as "tempid",c.xm_ids as "xmids",c.id as "oldCardInfoId"
		from
			c_card_temp c
		left outer join t_card_info t on t .old_card_info_id = c. id
		where
			t.id is null
	</select> 
	<!-- 变更对比-->
	<select id="find.t_card_infoByOldTemp.update" resultClass="cardInfo" parameterClass="map" >
		select
			2 as "cardType",c.year,c.month,c.dept_no as "deptno",c.dept_name as "deptname",c.owner,
			c.mobile,c.car_no as "carno", c.use_date as "expiredate",c.note,c.user_id as "userid",
			c.status,c.car_type as "cartype",c.temp_id as "tempid",c.xm_ids as "xmids",c.id as "oldCardInfoId",
			t.id
		from c_card_temp c,t_card_info t 
			where c.id=t.old_card_info_id   
				and c.car_type||c.status||c.owner||c.car_no||c.year||c.xm_ids||c.car_type||c.dept_no||c.mobile||c.user_id||c.temp_id
				!=t.car_type||t.status||t.owner||t.car_no||t.y_name||t.xm_ids||t.car_type||t.dept_no||t.mobile||t.user_id||t.temp_id	
	</select>
	<!-- 进校证数据 end -->
</sqlMap>

