<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap> 

<!-- 车辆进出次数统计-->
<select id="report.inOutCarTotal.total" resultClass="mapBean" parameterClass="map" >
	SELECT 
		PL."NAME" AS name,INCAR.innum,OUTCAR.outnum
	FROM
		T_PARKING_LOT PL
	LEFT JOIN T_PASSAGES PAS ON PL."ID"=PAS.PARKINGLOT_ID  
	LEFT JOIN (
		SELECT 
			COUNT(*) innum,
			PL."NAME" 
		FROM 
			T_PARKING_ORDER PO
		LEFT JOIN T_PASSAGES PAS ON PO.IN_SCHOOL_DOOR_NAME=PAS."ID"
		LEFT JOIN T_PARKING_LOT PL ON PL."ID"=PAS.PARKINGLOT_ID  
		WHERE 
			1=1
			<isNotEmpty    property="GTE_startTime">
			AND <![CDATA[to_char(PO.IN_TIME,'yyyy-MM-dd') >= #GTE_startTime#]]>
			</isNotEmpty>
			<isNotEmpty    property="LTE_endTime">
			AND <![CDATA[to_char(PO.IN_TIME,'yyyy-MM-dd') <= #LTE_endTime#]]>			 
			</isNotEmpty>
		GROUP BY 
			PL."NAME"
	)	INCAR ON INCAR."NAME"=PL."NAME"
	LEFT JOIN (
		SELECT 
			COUNT(*) outnum,
			PL."NAME" 
		FROM 
			T_PARKING_ORDER PO
		LEFT JOIN T_PASSAGES PAS ON PO.OUT_SCHOOL_DOOR_NAME=PAS."ID"
		LEFT JOIN T_PARKING_LOT PL ON PL."ID"=PAS.PARKINGLOT_ID  
		WHERE 
			1=1
			<isNotEmpty    property="GTE_startTime">
			AND <![CDATA[to_char(PO.OUT_TIME,'yyyy-MM-dd') >= #GTE_startTime#]]>
			</isNotEmpty>
			<isNotEmpty    property="LTE_endTime">
			AND <![CDATA[to_char(PO.OUT_TIME,'yyyy-MM-dd') <= #LTE_endTime#]]>			 
			</isNotEmpty>
		GROUP BY 
			PL."NAME"
	)	OUTCAR ON OUTCAR."NAME"=PL."NAME"
	GROUP BY 
			PL."NAME",INCAR.innum,OUTCAR.outnum
</select>
	
	
	
</sqlMap>

